THREE.PLYExporter=class{parse(t,e,n){function i(e){t.traverse(function(t){if(!0===t.isMesh){const n=t,i=n.geometry;if(!0!==i.isBufferGeometry)throw new Error("THREE.PLYExporter: Geometry is not of type THREE.BufferGeometry.");!0===i.hasAttribute("position")&&e(n,i)}})}e&&"object"==typeof e&&(console.warn('THREE.PLYExporter: The options parameter is now the third argument to the "parse" function. See the documentation for the new API.'),n=e,e=void 0);const o=(n=Object.assign({binary:!1,excludeAttributes:[],littleEndian:!1},n)).excludeAttributes;let r=!1,l=!1,a=!1,s=0,u=0;t.traverse(function(t){if(!0===t.isMesh){const e=t.geometry;if(!0!==e.isBufferGeometry)throw new Error("THREE.PLYExporter: Geometry is not of type THREE.BufferGeometry.");const n=e.getAttribute("position"),i=e.getAttribute("normal"),o=e.getAttribute("uv"),f=e.getAttribute("color"),g=e.getIndex();if(void 0===n)return;s+=n.count,u+=g?g.count/3:n.count/3,void 0!==i&&(r=!0),void 0!==o&&(a=!0),void 0!==f&&(l=!0)}});const f=-1===o.indexOf("index");if(r=r&&-1===o.indexOf("normal"),l=l&&-1===o.indexOf("color"),a=a&&-1===o.indexOf("uv"),f&&u!==Math.floor(u))return console.error("PLYExporter: Failed to generate a valid PLY file with triangle indices because the number of indices is not divisible by 3."),null;let g=`ply\nformat ${n.binary?n.littleEndian?"binary_little_endian":"binary_big_endian":"ascii"} 1.0\nelement vertex ${s}\nproperty float x\nproperty float y\nproperty float z\n`;!0===r&&(g+="property float nx\nproperty float ny\nproperty float nz\n"),!0===a&&(g+="property float s\nproperty float t\n"),!0===l&&(g+="property uchar red\nproperty uchar green\nproperty uchar blue\n"),!0===f&&(g+=`element face ${u}\nproperty list uchar int vertex_index\n`),g+="end_header\n";const d=new THREE.Vector3,c=new THREE.Matrix3;let p=null;if(!0===n.binary){const t=(new TextEncoder).encode(g),e=s*(12+(r?12:0)+(l?3:0)+(a?8:0)),o=f?13*u:0,y=new DataView(new ArrayBuffer(t.length+e+o));new Uint8Array(y.buffer).set(t,0);let E=t.length,x=t.length+e,b=0;i(function(t,e){const i=e.getAttribute("position"),o=e.getAttribute("normal"),s=e.getAttribute("uv"),u=e.getAttribute("color"),g=e.getIndex();c.getNormalMatrix(t.matrixWorld);for(let e=0,f=i.count;e<f;e++)d.x=i.getX(e),d.y=i.getY(e),d.z=i.getZ(e),d.applyMatrix4(t.matrixWorld),y.setFloat32(E,d.x,n.littleEndian),E+=4,y.setFloat32(E,d.y,n.littleEndian),E+=4,y.setFloat32(E,d.z,n.littleEndian),E+=4,!0===r&&(null!=o?(d.x=o.getX(e),d.y=o.getY(e),d.z=o.getZ(e),d.applyMatrix3(c).normalize(),y.setFloat32(E,d.x,n.littleEndian),E+=4,y.setFloat32(E,d.y,n.littleEndian),E+=4,y.setFloat32(E,d.z,n.littleEndian),E+=4):(y.setFloat32(E,0,n.littleEndian),E+=4,y.setFloat32(E,0,n.littleEndian),E+=4,y.setFloat32(E,0,n.littleEndian),E+=4)),!0===a&&(null!=s?(y.setFloat32(E,s.getX(e),n.littleEndian),E+=4,y.setFloat32(E,s.getY(e),n.littleEndian),E+=4):!1!==a&&(y.setFloat32(E,0,n.littleEndian),E+=4,y.setFloat32(E,0,n.littleEndian),E+=4)),!0===l&&(null!=u?(y.setUint8(E,Math.floor(255*u.getX(e))),E+=1,y.setUint8(E,Math.floor(255*u.getY(e))),E+=1,y.setUint8(E,Math.floor(255*u.getZ(e))),E+=1):(y.setUint8(E,255),E+=1,y.setUint8(E,255),E+=1,y.setUint8(E,255),E+=1));if(!0===f)if(null!==g)for(let t=0,e=g.count;t<e;t+=3)y.setUint8(x,3),x+=1,y.setUint32(x,g.getX(t+0)+b,n.littleEndian),x+=4,y.setUint32(x,g.getX(t+1)+b,n.littleEndian),x+=4,y.setUint32(x,g.getX(t+2)+b,n.littleEndian),x+=4;else for(let t=0,e=i.count;t<e;t+=3)y.setUint8(x,3),x+=1,y.setUint32(x,b+t,n.littleEndian),x+=4,y.setUint32(x,b+t+1,n.littleEndian),x+=4,y.setUint32(x,b+t+2,n.littleEndian),x+=4;b+=i.count}),p=y.buffer}else{let t=0,e="",n="";i(function(i,o){const s=o.getAttribute("position"),g=o.getAttribute("normal"),p=o.getAttribute("uv"),y=o.getAttribute("color"),E=o.getIndex();c.getNormalMatrix(i.matrixWorld);for(let t=0,n=s.count;t<n;t++){d.x=s.getX(t),d.y=s.getY(t),d.z=s.getZ(t),d.applyMatrix4(i.matrixWorld);let n=d.x+" "+d.y+" "+d.z;!0===r&&(null!=g?(d.x=g.getX(t),d.y=g.getY(t),d.z=g.getZ(t),d.applyMatrix3(c).normalize(),n+=" "+d.x+" "+d.y+" "+d.z):n+=" 0 0 0"),!0===a&&(null!=p?n+=" "+p.getX(t)+" "+p.getY(t):!1!==a&&(n+=" 0 0")),!0===l&&(n+=null!=y?" "+Math.floor(255*y.getX(t))+" "+Math.floor(255*y.getY(t))+" "+Math.floor(255*y.getZ(t)):" 255 255 255"),e+=n+"\n"}if(!0===f){if(null!==E)for(let e=0,i=E.count;e<i;e+=3)n+=`3 ${E.getX(e+0)+t}`,n+=` ${E.getX(e+1)+t}`,n+=` ${E.getX(e+2)+t}\n`;else for(let e=0,i=s.count;e<i;e+=3)n+=`3 ${t+e} ${t+e+1} ${t+e+2}\n`;u+=E?E.count/3:s.count/3}t+=s.count}),p=`${g}${e}${f?`${n}\n`:"\n"}`}return"function"==typeof e&&requestAnimationFrame(()=>e(p)),p}};