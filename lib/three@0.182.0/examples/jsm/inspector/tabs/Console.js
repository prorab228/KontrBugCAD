import{Tab}from"../ui/Tab.js";class Console extends Tab{constructor(e={}){super("Console",e),this.filters={info:!0,warn:!0,error:!0},this.filterText="",this.buildHeader(),this.logContainer=document.createElement("div"),this.logContainer.id="console-log",this.content.appendChild(this.logContainer)}buildHeader(){const e=document.createElement("div");e.className="console-header";const t=document.createElement("input");t.type="text",t.className="console-filter-input",t.placeholder="Filter...",t.addEventListener("input",e=>{this.filterText=e.target.value.toLowerCase(),this.applyFilters()});const s=document.createElement("div");s.className="console-filters-group",Object.keys(this.filters).forEach(e=>{const t=document.createElement("label");t.className="custom-checkbox",t.style.color=`var(--${"info"===e?"text-primary":"color-"+("warn"===e?"yellow":"red")})`;const n=document.createElement("input");n.type="checkbox",n.checked=this.filters[e],n.dataset.type=e;const o=document.createElement("span");o.className="checkmark",t.appendChild(n),t.appendChild(o),t.append(e.charAt(0).toUpperCase()+e.slice(1)),s.appendChild(t)}),s.addEventListener("change",e=>{const t=e.target.dataset.type;t in this.filters&&(this.filters[t]=e.target.checked,this.applyFilters())}),e.appendChild(t),e.appendChild(s),this.content.appendChild(e)}applyFilters(){this.logContainer.querySelectorAll(".log-message").forEach(e=>{const t=e.dataset.type,s=e.dataset.rawText.toLowerCase(),n=this.filters[t],o=s.includes(this.filterText);e.classList.toggle("hidden",!(n&&o))})}_getIcon(e,t){let s;return"tip"===t?s="ðŸ’­":"tsl"===t?s="âœ¨":"webgpurenderer"===t?s="ðŸŽ¨":"warn"===e?s="âš ï¸":"error"===e?s="ðŸ”´":"info"===e&&(s="â„¹ï¸"),s}_formatMessage(e,t){const s=document.createDocumentFragment(),n=t.match(/^([\w\.]+:\s)/);let o=t;if(n){const l=n[0],a=l.slice(0,-2).split("."),i=(a.length>1?a[a.length-1]:a[0])+":",r=this._getIcon(e,i.split(":")[0].toLowerCase());s.appendChild(document.createTextNode(r+" "));const c=document.createElement("span");c.className="log-prefix",c.textContent=i,s.appendChild(c),o=t.substring(l.length)}const l=o.split(/(".*?"|'.*?'|`.*?`)/g).map(e=>e.trim()).filter(Boolean);return l.forEach((e,t)=>{if(/^("|'|`)/.test(e)){const t=document.createElement("span");t.className="log-code",t.textContent=e.slice(1,-1),s.appendChild(t)}else t>0&&(e=" "+e),t<l.length-1&&(e+=" "),s.appendChild(document.createTextNode(e))}),s}addMessage(e,t){const s=document.createElement("div");s.className=`log-message ${e}`,s.dataset.type=e,s.dataset.rawText=t,s.appendChild(this._formatMessage(e,t));const n=this.filters[e],o=t.toLowerCase().includes(this.filterText);s.classList.toggle("hidden",!(n&&o)),this.logContainer.appendChild(s),this.logContainer.scrollTop=this.logContainer.scrollHeight,this.logContainer.children.length>200&&this.logContainer.removeChild(this.logContainer.firstChild)}}export{Console};