import{Tab}from"../ui/Tab.js";import{List}from"../ui/List.js";import{Item}from"../ui/Item.js";import{RendererUtils,NoToneMapping,LinearSRGBColorSpace}from"three/webgpu";class Viewer extends Tab{constructor(e={}){super("Viewer",e);const t=new List("Viewer","Name");t.setGridStyle("150px minmax(200px, 2fr)"),t.domElement.style.minWidth="400px";const r=document.createElement("div");r.className="list-scroll-wrapper",r.appendChild(t.domElement),this.content.appendChild(r);const i=new Item("Nodes");t.add(i),this.itemLibrary=new Map,this.folderLibrary=new Map,this.currentDataList=[],this.nodeList=t,this.nodes=i}getFolder(e){let t=this.folderLibrary.get(e);return void 0===t&&(t=new Item(e),this.folderLibrary.set(e,t),this.nodeList.add(t)),t}addNodeItem(e){let t=this.itemLibrary.get(e.id);if(void 0===t){const r=e.name,i=e.canvasTarget.domElement;t=new Item(i,r),t.itemRow.children[1].style["justify-content"]="flex-start",this.itemLibrary.set(e.id,t)}return t}update(e,t){if(!this.isActive&&!this.isDetached)return;const r=[...this.currentDataList];for(const e of r)if(this.itemLibrary.has(e.id)&&-1===t.indexOf(e)){const t=this.itemLibrary.get(e.id),r=t.parent;r.remove(t),this.folderLibrary.has(r.data[0])&&0===r.children.length&&(r.parent.remove(r),this.folderLibrary.delete(r.data[0])),this.itemLibrary.delete(e.id)}const i={};for(const r of t){const s=this.addNodeItem(r),a=e.getCanvasTarget(),n=r.path;if(n){const e=this.getFolder(n);void 0===i[n]&&(i[n]=0),null!==e.parent&&s.parent===e&&e.children.indexOf(s)===i[n]||e.add(s),i[n]++}else s.parent||this.nodes.add(s);this.currentDataList=t;const o=RendererUtils.resetRendererState(e);e.toneMapping=NoToneMapping,e.outputColorSpace=LinearSRGBColorSpace,e.setCanvasTarget(r.canvasTarget),r.quad.render(e),e.setCanvasTarget(a),RendererUtils.restoreRendererState(e,o)}}}export{Viewer};