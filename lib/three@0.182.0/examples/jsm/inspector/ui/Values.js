import{EventDispatcher}from"three";class Value extends EventDispatcher{constructor(){super(),this.domElement=document.createElement("div"),this.domElement.className="param-control",this._onChangeFunction=null,this.addEventListener("change",e=>{requestAnimationFrame(()=>{this._onChangeFunction&&this._onChangeFunction(e.value)})})}setValue(){return this.dispatchChange(),this}getValue(){return null}dispatchChange(){this.dispatchEvent({type:"change",value:this.getValue()})}onChange(e){return this._onChangeFunction=e,this}}class ValueNumber extends Value{constructor({value:e=0,step:t=.1,min:s=-1/0,max:n=1/0}){super(),this.input=document.createElement("input"),this.input.type="number",this.input.value=e,this.input.step=t,this.input.min=s,this.input.max=n,this.input.addEventListener("change",this._onChangeValue.bind(this)),this.domElement.appendChild(this.input),this.addDragHandler()}_onChangeValue(){const e=parseFloat(this.input.value),t=parseFloat(this.input.min),s=parseFloat(this.input.max);e>s?this.input.value=s:(e<t||isNaN(e))&&(this.input.value=t),this.dispatchChange()}addDragHandler(){let e,t,s=!1;this.input.addEventListener("mousedown",n=>{s=!0,e=n.clientY,t=parseFloat(this.input.value),document.body.style.cursor="ns-resize"}),document.addEventListener("mousemove",n=>{if(s){const s=e-n.clientY,i=parseFloat(this.input.step)||1,a=parseFloat(this.input.min),u=parseFloat(this.input.max);let l=i;!isNaN(u)&&isFinite(a)&&(l=(u-a)/100);let r=t+s*l;r=Math.max(a,Math.min(r,u));const h=(String(i).split(".")[1]||[]).length;this.input.value=r.toFixed(h),this.input.dispatchEvent(new Event("input")),this.dispatchChange()}}),document.addEventListener("mouseup",()=>{s&&(s=!1,document.body.style.cursor="default")})}setValue(e){return this.input.value=e,super.setValue(e)}getValue(){return parseFloat(this.input.value)}}class ValueCheckbox extends Value{constructor({value:e=!1}){super();const t=document.createElement("label");t.className="custom-checkbox";const s=document.createElement("input");s.type="checkbox",s.checked=e,this.checkbox=s;const n=document.createElement("span");n.className="checkmark",t.appendChild(s),t.appendChild(n),this.domElement.appendChild(t),s.addEventListener("change",()=>{this.dispatchChange()})}setValue(e){return this.checkbox.value=e,super.setValue(e)}getValue(){return this.checkbox.checked}}class ValueSlider extends Value{constructor({value:e=0,min:t=0,max:s=1,step:n=.01}){super(),this.slider=document.createElement("input"),this.slider.type="range",this.slider.min=t,this.slider.max=s,this.slider.step=n;const i=new ValueNumber({value:e,min:t,max:s,step:n});this.numberInput=i.input,this.numberInput.style.flexBasis="80px",this.numberInput.style.flexShrink="0",this.slider.value=e,this.domElement.append(this.slider,this.numberInput),this.slider.addEventListener("input",()=>{this.numberInput.value=this.slider.value,this.dispatchChange()}),i.addEventListener("change",()=>{this.slider.value=parseFloat(this.numberInput.value),this.dispatchChange()})}setValue(e){return this.slider.value=e,this.numberInput.value=e,super.setValue(e)}getValue(){return parseFloat(this.slider.value)}step(e){return this.slider.step=e,this.numberInput.step=e,this}}class ValueSelect extends Value{constructor({options:e=[],value:t=""}){super();const s=document.createElement("select"),n=(e,n)=>{const i=document.createElement("option");return i.value=e,i.textContent=e,n==t&&(i.selected=!0),s.appendChild(i),i};Array.isArray(e)?e.forEach(e=>n(e,e)):Object.entries(e).forEach(([e,t])=>n(e,t)),this.domElement.appendChild(s),s.addEventListener("change",()=>{this.dispatchChange()}),this.options=e,this.select=s}getValue(){const e=this.options;return Array.isArray(e)?e[this.select.selectedIndex]:e[this.select.value]}}class ValueColor extends Value{constructor({value:e="#ffffff"}){super();const t=document.createElement("input");t.type="color",t.value=this._getColorHex(e),this.colorInput=t,this._value=e,t.addEventListener("input",()=>{const e=t.value;this._value.isColor?this._value.setHex(parseInt(e.slice(1),16)):this._value=e,this.dispatchChange()}),this.domElement.appendChild(t)}_getColorHex(e){return e.isColor&&(e=e.getHex()),"number"==typeof e?e=`#${e.toString(16)}`:"#"!==e[0]&&(e="#"+e),e}getValue(){let e=this._value;return"string"==typeof e&&(e=parseInt(e.slice(1),16)),e}}class ValueButton extends Value{constructor({text:e="Button",value:t=()=>{}}){super();const s=document.createElement("button");s.textContent=e,s.onclick=t,this.domElement.appendChild(s)}}export{Value,ValueNumber,ValueCheckbox,ValueSlider,ValueSelect,ValueColor,ValueButton};