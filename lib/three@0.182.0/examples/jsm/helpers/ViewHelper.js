import{CylinderGeometry,CanvasTexture,Color,Euler,Mesh,MeshBasicMaterial,Object3D,OrthographicCamera,Quaternion,Raycaster,Sprite,SpriteMaterial,SRGBColorSpace,Vector2,Vector3,Vector4}from"three";class ViewHelper extends Object3D{constructor(e,t){super(),this.isViewHelper=!0,this.animating=!1,this.center=new Vector3;const a=new Color("#ff4466"),i=new Color("#88ff44"),r=new Color("#4488ff"),s=new Color("#000000"),o={},n=[],l=new Raycaster,p=new Vector2,c=new Object3D,d=new OrthographicCamera(-2,2,2,-2,0,4);d.position.set(0,0,2);const u=new CylinderGeometry(.04,.04,.8,5).rotateZ(-Math.PI/2).translate(.4,0,0),h=new Mesh(u,Y(a)),m=new Mesh(u,Y(i)),w=new Mesh(u,Y(r));m.rotation.z=Math.PI/2,w.rotation.y=-Math.PI/2,this.add(h),this.add(w),this.add(m);const f=q(a),y=q(i),g=q(r),M=q(s),b=new Sprite(f),C=new Sprite(y),S=new Sprite(g),x=new Sprite(M),V=new Sprite(M),E=new Sprite(M);b.position.x=1,C.position.y=1,S.position.z=1,x.position.x=-1,V.position.y=-1,E.position.z=-1,x.material.opacity=.2,V.material.opacity=.2,E.material.opacity=.2,b.userData.type="posX",C.userData.type="posY",S.userData.type="posZ",x.userData.type="negX",V.userData.type="negY",E.userData.type="negZ",this.add(b),this.add(C),this.add(S),this.add(x),this.add(V),this.add(E),n.push(b),n.push(C),n.push(S),n.push(x),n.push(V),n.push(E);const P=new Vector3,D=128,I=2*Math.PI;this.render=function(a){this.quaternion.copy(e.quaternion).invert(),this.updateMatrixWorld(),P.set(0,0,1),P.applyQuaternion(e.quaternion);const i=t.offsetWidth-D,r=a.isWebGPURenderer?t.offsetHeight-D:0;a.clearDepth(),a.getViewport(T),a.setViewport(i,r,D,D),a.render(this,d),a.setViewport(T.x,T.y,T.z,T.w)};const k=new Vector3,O=new Quaternion,v=new Quaternion,F=new Quaternion,T=new Vector4;let X=0;function Y(e){return new MeshBasicMaterial({color:e,toneMapped:!1})}function Z(e,t){let a;return!function(){let e=!1;try{e="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}return e}()?(a=document.createElement("canvas"),a.width=e,a.height=t):a=new OffscreenCanvas(e,t),a}function q(e,t){const{font:a="24px Arial",color:i="#000000",radius:r=14}=o,s=Z(64,64),n=s.getContext("2d");n.beginPath(),n.arc(32,32,r,0,2*Math.PI),n.closePath(),n.fillStyle=e.getStyle(),n.fill(),t&&(n.font=a,n.textAlign="center",n.fillStyle=i,n.fillText(t,32,41));const l=new CanvasTexture(s);return l.colorSpace=SRGBColorSpace,new SpriteMaterial({map:l,toneMapped:!1})}function H(){b.material.map.dispose(),C.material.map.dispose(),S.material.map.dispose(),b.material.dispose(),C.material.dispose(),S.material.dispose(),b.material=q(a,o.labelX),C.material=q(i,o.labelY),S.material=q(r,o.labelZ)}this.handleClick=function(a){if(!0===this.animating)return!1;const i=t.getBoundingClientRect(),r=i.left+(t.offsetWidth-D),s=i.top+(t.offsetHeight-D);p.x=(a.clientX-r)/(i.right-r)*2-1,p.y=-(a.clientY-s)/(i.bottom-s)*2+1,l.setFromCamera(p,d);const o=l.intersectObjects(n);if(o.length>0){return function(t,a){switch(t.userData.type){case"posX":k.set(1,0,0),O.setFromEuler(new Euler(0,.5*Math.PI,0));break;case"posY":k.set(0,1,0),O.setFromEuler(new Euler(.5*-Math.PI,0,0));break;case"posZ":k.set(0,0,1),O.setFromEuler(new Euler);break;case"negX":k.set(-1,0,0),O.setFromEuler(new Euler(0,.5*-Math.PI,0));break;case"negY":k.set(0,-1,0),O.setFromEuler(new Euler(.5*Math.PI,0,0));break;case"negZ":k.set(0,0,-1),O.setFromEuler(new Euler(0,Math.PI,0));break;default:console.error("ViewHelper: Invalid axis.")}X=e.position.distanceTo(a),k.multiplyScalar(X).add(a),c.position.copy(a),c.lookAt(e.position),v.copy(c.quaternion),c.lookAt(k),F.copy(c.quaternion)}(o[0].object,this.center),this.animating=!0,!0}return!1},this.setLabels=function(e,t,a){o.labelX=e,o.labelY=t,o.labelZ=a,H()},this.setLabelStyle=function(e,t,a){o.font=e,o.color=t,o.radius=a,H()},this.update=function(t){const a=t*I;v.rotateTowards(F,a),e.position.set(0,0,1).applyQuaternion(v).multiplyScalar(X).add(this.center),e.quaternion.rotateTowards(O,a),0===v.angleTo(F)&&(this.animating=!1)},this.dispose=function(){u.dispose(),h.material.dispose(),m.material.dispose(),w.material.dispose(),b.material.map.dispose(),C.material.map.dispose(),S.material.map.dispose(),x.material.map.dispose(),V.material.map.dispose(),E.material.map.dispose(),b.material.dispose(),C.material.dispose(),S.material.dispose(),x.material.dispose(),V.material.dispose(),E.material.dispose()}}}export{ViewHelper};