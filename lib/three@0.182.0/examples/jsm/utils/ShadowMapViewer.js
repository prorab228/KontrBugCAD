import{DoubleSide,CanvasTexture,Mesh,MeshBasicMaterial,OrthographicCamera,PlaneGeometry,Scene,ShaderMaterial}from"three";class ShadowMapViewer{constructor(t){const e=this,i=void 0!==t.name&&""!==t.name;let n;const o=10,s=10,a=256,h=256,r=new OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,1,10);r.position.set(0,0,2);const d=new Scene,l=new ShaderMaterial({uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"\n\t\t\t\tuniform float opacity;\n\t\t\t\tuniform sampler2D tDiffuse;\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tfloat depth = texture2D( tDiffuse, vUv ).r;\n\t\t\t\t\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\t\t\t\t\tgl_FragColor = vec4( vec3( depth ), opacity );\n\t\t\t\t\t#else\n\t\t\t\t\t\tgl_FragColor = vec4( vec3( 1.0 - depth ), opacity );\n\t\t\t\t\t#endif\n\t\t\t\t}"}),w=new PlaneGeometry(a,h),p=new Mesh(w,l);let c,u;if(d.add(p),i){c=document.createElement("canvas");const e=c.getContext("2d");e.font="Bold 20px Arial";const i=e.measureText(t.name).width;c.width=i,c.height=25,e.font="Bold 20px Arial",e.fillStyle="rgba( 255, 0, 0, 1 )",e.fillText(t.name,0,20);const n=new CanvasTexture(c),o=new MeshBasicMaterial({map:n,side:DoubleSide,transparent:!0}),s=new PlaneGeometry(c.width,c.height);u=new Mesh(s,o),d.add(u)}this.enabled=!0,this.size={width:a,height:h,set:function(t,i){this.width=t,this.height=i,p.scale.set(this.width/a,this.height/h,1),e.position.set(e.position.x,e.position.y)}},this.position={x:o,y:s,set:function(t,n){this.x=t,this.y=n;const o=e.size.width,s=e.size.height;p.position.set(-window.innerWidth/2+o/2+this.x,window.innerHeight/2-s/2-this.y,0),i&&u.position.set(p.position.x,p.position.y-e.size.height/2+c.height/2,0)}},this.render=function(e){this.enabled&&(l.uniforms.tDiffuse.value=t.shadow.map.texture,n=e.autoClear,e.autoClear=!1,e.clearDepth(),e.render(d,r),e.autoClear=n)},this.updateForWindowResize=function(){this.enabled&&(r.left=window.innerWidth/-2,r.right=window.innerWidth/2,r.top=window.innerHeight/2,r.bottom=window.innerHeight/-2,r.updateProjectionMatrix(),this.update())},this.update=function(){this.position.set(this.position.x,this.position.y),this.size.set(this.size.width,this.size.height)},this.update()}}export{ShadowMapViewer};