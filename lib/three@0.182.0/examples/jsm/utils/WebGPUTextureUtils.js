import{QuadMesh,NodeMaterial,WebGPURenderer,CanvasTexture}from"three/webgpu";import{texture,uv}from"three/tsl";let _renderer;const _quadMesh=new QuadMesh;export async function decompress(e,r=1/0,t=null){null===t&&(t=_renderer=new WebGPURenderer,await t.init());const a=new NodeMaterial;a.fragmentNode=texture(e,uv().flipY());const n=Math.min(e.image.width,r),o=Math.min(e.image.height,r),i=t.outputColorSpace;t.setSize(n,o),t.outputColorSpace=e.colorSpace,_quadMesh.material=a,_quadMesh.render(t),t.outputColorSpace=i;const l=document.createElement("canvas"),u=l.getContext("2d");l.width=n,l.height=o,u.drawImage(t.domElement,0,0,n,o);const d=new CanvasTexture(l);return d.minFilter=e.minFilter,d.magFilter=e.magFilter,d.wrapS=e.wrapS,d.wrapT=e.wrapT,d.colorSpace=e.colorSpace,d.name=e.name,null!==_renderer&&(_renderer.dispose(),_renderer=null),d}