import{Fn,vec2,uv,Loop,vec4,premultiplyAlpha,unpremultiplyAlpha,max,int,textureSize,nodeObject,convertToTexture}from"three/tsl";export const boxBlur=Fn(([e,t={}])=>{e=convertToTexture(e);const n=nodeObject(t.size)||int(1),o=nodeObject(t.separation)||int(1),i=t.premultipliedAlpha||!1,r=e.uvNode||uv(),p=vec4(0),l=max(o,1),a=int(0),u=vec2(1).div(textureSize(e));return Loop({start:n.negate(),end:n,name:"i",condition:"<="},({i:t})=>{Loop({start:n.negate(),end:n,name:"j",condition:"<="},({j:n})=>{const o=r.add(vec2(t,n).mul(u).mul(l));p.addAssign((t=>{const n=e.sample(t);return i?premultiplyAlpha(n):n})(o)),a.addAssign(1)})}),p.divAssign(a),i?unpremultiplyAlpha(p):p});