class SelectTool extends Tool{constructor(t){super("select","fa-mouse-pointer",t),this.isDragging=!1,this.dragManager=t.dragManager,this.clickThreshold=5,this.clickStartPos=null}onActivate(){this.editor.sketchMode&&this.editor.exitSketchMode(),this.editor.extrudeMode&&this.editor.extrudeManager.cancelExtrudeMode(),this.editor.workPlaneMode&&this.editor.planesManager.exitWorkPlaneMode(),this.editor.transformControls&&(this.editor.transformControls.detach(),this.editor.transformControls.hide())}onDeactivate(){this.isDragging&&this.endDrag(),this.dragManager&&this.dragManager.clearLinesAndInputs()}onMouseDown(t){if(0!==t.button)return!1;this.editor.updateMousePosition(t),this.editor.raycaster.setFromCamera(this.editor.mouse,this.editor.camera);const e=this.editor.getVisibleObjects(),i=this.editor.raycaster.intersectObjects(e,!1);if(this.clickStartPos={x:t.clientX,y:t.clientY},i.length>0){const e=this.editor.objectsManager.findTopParent(i[0].object);return this.canDragObject(e)?(this.prepareDrag(e,i[0].point),!0):(this.handleSelection(t,e),!0)}return this.editor.clearSelection(),!1}onMouseMove(t){if(this.clickStartPos&&!this.isDragging){const e=Math.abs(t.clientX-this.clickStartPos.x),i=Math.abs(t.clientY-this.clickStartPos.y);Math.sqrt(e*e+i*i)>this.clickThreshold&&this.dragManager&&this.startDrag(t)}this.isDragging&&this.dragManager&&this.dragManager.onMouseMove(t)}onMouseUp(t){this.isDragging?this.endDrag():this.clickStartPos&&this.handleClick(t),this.isDragging=!1,this.clickStartPos=null}prepareDrag(t,e){this.dragManager&&this.dragManager.prepareDrag(t,e)}startDrag(t){this.isDragging=!0,this.dragManager&&this.dragManager.startDrag(t),this.editor.showStatus("Перетаскивание объекта","info")}endDrag(){this.dragManager&&this.dragManager.finishDrag(),this.isDragging=!1,this.clickStartPos=null}handleSelection(t,e){t.ctrlKey||t.metaKey?this.editor.toggleObjectSelection(e):this.editor.selectSingleObject(e),this.editor.updatePropertiesPanel(),this.editor.updateStatus()}handleClick(t){this.editor.updateMousePosition(t),this.editor.raycaster.setFromCamera(this.editor.mouse,this.editor.camera);const e=this.editor.raycaster.intersectObjects(this.editor.objectsGroup.children,!0);if(e.length>0){const i=this.editor.objectsManager.findTopParent(e[0].object);this.handleSelection(t,i)}else{this.editor.clearSelection(),this.dragManager&&this.dragManager.resetDrag();const t=this.editor.toolManager.activeTool;t&&"move"===t.name&&t.clearMoveLine&&t.clearMoveLine()}}onDoubleClick(t){if(0!==t.button)return!1;this.editor.updateMousePosition(t),this.editor.raycaster.setFromCamera(this.editor.mouse,this.editor.camera);const e=this.editor.raycaster.intersectObjects(this.editor.objectsGroup.children,!0);if(e.length>0){const t=this.editor.objectsManager.findTopParent(e[0].object);if("sketch_plane"===t.userData.type||"work_plane"===t.userData.type){if(this.editor.objectsManager.checkPlaneForSketchElements(t)){this.editor.selectSingleObject(t);const e=this.editor.toolManager.getTool("sketch");return e&&e.editExistingSketch(t),!0}}return this.editor.focusCameraOnObject(t),!0}return!1}canDragObject(t){return!!t&&("work_plane"!==t.userData.type&&"sketch_plane"!==t.userData.type&&"base_plane"!==t.userData.type)}onKeyDown(t){return!("Escape"!==t.key||!this.isDragging)&&(this.dragManager&&this.dragManager.cancelDrag(),this.isDragging=!1,this.clickStartPos=null,!0)}}