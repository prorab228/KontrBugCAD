class TransformToolBase extends Tool{constructor(t,e,i){super(t,e,i),this.gizmoGroup=new THREE.Group,this.editor.scene.add(this.gizmoGroup),this.attachedObject=null,this.isDragging=!1,this.currentAxis=null,this.startPosition=new THREE.Vector3,this.startRotation=new THREE.Quaternion,this.startScale=new THREE.Vector3,this.startMouse=new THREE.Vector2,this.axisColors={x:16729156,y:4521796,z:4474111},this.snapEnabled=!0,this.moveSnapValue=1,this.sizeSnapValue=1,this.rotateSnapValue=5,this.moveDelta=new THREE.Vector3,this.sizeDelta=new THREE.Vector3,this.propertiesElement=null,this.requiresSelection=!0,this.lastMousePosition=new THREE.Vector2,this.tooltip=null,this.gizmoBaseSize=20,this.initGizmo()}initGizmo(){}onActivate(){super.onActivate(),this.createPropertiesSection(),1===this.editor.selectedObjects.length?this.attachToObject(this.editor.selectedObjects[0]):this.editor.showStatus(`Выберите объект для ${this.name}`,"info")}onDeactivate(){super.onDeactivate(),this.removePropertiesSection(),this.removeTooltip(),this.detach(),this.gizmoGroup.visible=!1}createPropertiesSection(){const t=document.getElementById("propertiesContent");if(!t)return;console.log(`Создание раздела свойств для ${this.name}`);const e=t.querySelector(`.property-group[data-tool="${this.name}"]`);e&&e.remove(),this.propertiesElement=document.createElement("div"),this.propertiesElement.className="property-group",this.propertiesElement.setAttribute("data-tool",this.name),this.propertiesElement.innerHTML=this.getPropertiesHTML(),t.appendChild(this.propertiesElement),this.bindPropertiesEvents()}removePropertiesSection(){this.propertiesElement&&this.propertiesElement.parentNode&&this.propertiesElement.parentNode.removeChild(this.propertiesElement),this.propertiesElement=null}getPropertiesHTML(){return""}bindPropertiesEvents(){}attachToObject(t){t&&this.canTransformObject(t)&&(this.attachedObject=t,this.updateGizmoPosition(),this.gizmoGroup.visible=!0,this.updatePropertiesValues())}detach(){this.attachedObject=null,this.gizmoGroup.visible=!1}updateGizmoPosition(){if(!this.attachedObject)return;const t=new THREE.Vector3;this.attachedObject.getWorldPosition(t),this.gizmoGroup.position.copy(t),this.useLocalCoordinates?this.gizmoGroup.quaternion.copy(this.attachedObject.quaternion):this.gizmoGroup.quaternion.identity();const e=(new THREE.Box3).setFromObject(this.attachedObject),i=new THREE.Vector3;e.getSize(i);const o=Math.max(i.x,i.y,i.z),s=Math.max(10,1.5*o);this.gizmoGroup.scale.setScalar(s/15)}updatePropertiesValues(){this.attachedObject}onMouseDown(t){if(0!==t.button)return!1;this.snapEnabled=!t.ctrlKey,this.editor.updateMousePosition(t),this.lastMousePosition.copy(this.editor.mouse),this.editor.raycaster.setFromCamera(this.editor.mouse,this.editor.camera);const e=[];this.gizmoGroup.traverse(t=>{t instanceof THREE.Mesh&&e.push(t)});const i=this.editor.raycaster.intersectObjects(e,!0);if(i.length>0){let e=null,o=i[0].object;for(;o&&!e;){if(o.userData&&o.userData.axis){e=o.userData.axis;break}o=o.parent}if(e)return this.startDragging(e,t),!0}const o=this.editor.raycaster.intersectObjects(this.editor.objectsGroup.children,!0);if(o.length>0){const t=this.editor.objectsManager.findTopParent(o[0].object);if(this.canTransformObject(t))return this.editor.selectSingleObject(t),this.attachToObject(t),!0}return!1}startDragging(t,e){this.currentAxis=t,this.isDragging=!0,this.startMouse.set(e.clientX,e.clientY),this.attachedObject&&(this.startPosition.copy(this.attachedObject.position),this.startRotation.copy(this.attachedObject.quaternion),this.startScale.copy(this.attachedObject.scale),this.attachedObject.userData.transformStartState={position:this.attachedObject.position.clone(),rotation:this.attachedObject.quaternion.clone(),scale:this.attachedObject.scale.clone()}),this.createTooltip()}onMouseMove(t){if(!this.isDragging||!this.attachedObject)return;this.snapEnabled=!t.ctrlKey;const e=t.clientX-this.startMouse.x,i=t.clientY-this.startMouse.y;this.handleTransform(e,i),this.updateGizmoPosition(),this.updatePropertiesValues(),this.updateTooltip()}handleTransform(t,e){}onMouseUp(t){this.isDragging&&this.attachedObject&&this.saveToHistory(),this.isDragging=!1,this.currentAxis=null,this.removeTooltip()}saveToHistory(){if(!this.attachedObject||!this.attachedObject.userData.transformStartState)return;const t=this.createHistoryAction();t&&this.editor.history.addAction(t),delete this.attachedObject.userData.transformStartState}createHistoryAction(){}getHistoryActionType(){return"transform"}getCurrentState(){return this.attachedObject?{position:this.attachedObject.position.clone(),rotation:this.attachedObject.quaternion.clone(),scale:this.attachedObject.scale.clone()}:null}canTransformObject(t){return!!t}update(){this.attachedObject&&this.gizmoGroup.visible&&this.updateGizmoPosition()}createTooltip(){this.removeTooltip();const t=document.createElement("div");t.className="transform-tooltip",t.style.cssText="\n            position: fixed;\n            background: rgba(0, 0, 0, 0.85);\n            color: white;\n            padding: 8px 12px;\n            border-radius: 6px;\n            font-family: 'Segoe UI', Arial, sans-serif;\n            font-size: 12px;\n            pointer-events: none;\n            z-index: 10000;\n            min-width: 180px;\n            backdrop-filter: blur(5px);\n            border: 1px solid rgba(255, 255, 255, 0.15);\n            display: flex;\n            flex-direction: column;\n            gap: 4px;\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n            transition: opacity 0.2s;\n        ",this.tooltip=t,document.body.appendChild(t)}updateTooltip(){if(!this.tooltip||!this.attachedObject)return;const t=this.getGizmoScreenPosition();if(!t)return;let e=this.getTooltipContent();e&&(this.tooltip.innerHTML=e,this.tooltip.style.left=t.x+120+"px",this.tooltip.style.top=t.y-this.tooltip.offsetHeight/2+"px")}getGizmoScreenPosition(){if(!this.attachedObject)return null;const t=new THREE.Vector3;this.attachedObject.getWorldPosition(t),t.project(this.editor.camera);const e=this.editor.renderer.domElement.clientWidth,i=this.editor.renderer.domElement.clientHeight;return{x:(.5*t.x+.5)*e,y:(.5*-t.y+.5)*i}}getTooltipContent(){return""}removeTooltip(){this.tooltip&&this.tooltip.parentNode&&this.tooltip.parentNode.removeChild(this.tooltip),this.tooltip=null}}