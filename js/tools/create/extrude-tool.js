import{ExtrudeManager}from"./ExtrudeManager.js";import{Tool}from"../tool.js";export class ExtrudeTool extends Tool{constructor(e){super("extrude","fa-arrows-alt-v",e),this.extrudeManager=new ExtrudeManager(e),this.isExtrudeMode=!1,console.log("ExtrudeTool: создан")}startExtrudeMode(){console.log("=== START EXTRUDE MODE ==="),this.isExtrudeMode=!0,this.extrudeManager.initialize(),this.extrudeManager.highlightExtrudableFigures(),this.extrudeManager.showExtrudeUI(),this.attachEventListeners(),this.editor.showStatus("Режим вытягивания: кликните по фигурам для выбора","info")}attachEventListeners(){console.log("ExtrudeTool: добавляем обработчики событий"),this.mouseDownHandler=e=>this.onMouseDown(e),this.mouseMoveHandler=e=>this.onMouseMove(e),this.mouseUpHandler=e=>this.onMouseUp(e),this.keyDownHandler=e=>this.onKeyDown(e),this.keyUpHandler=e=>this.onKeyUp(e);const e=this.editor.renderer.domElement;e.addEventListener("mousedown",this.mouseDownHandler),e.addEventListener("mousemove",this.mouseMoveHandler),e.addEventListener("mouseup",this.mouseUpHandler),document.addEventListener("keydown",this.keyDownHandler),document.addEventListener("keyup",this.keyUpHandler)}detachEventListeners(){console.log("ExtrudeTool: удаляем обработчики событий");const e=this.editor.renderer.domElement;this.mouseDownHandler&&e.removeEventListener("mousedown",this.mouseDownHandler),this.mouseMoveHandler&&e.removeEventListener("mousemove",this.mouseMoveHandler),this.mouseUpHandler&&e.removeEventListener("mouseup",this.mouseUpHandler),this.keyDownHandler&&document.removeEventListener("keydown",this.keyDownHandler),this.keyUpHandler&&document.removeEventListener("keyup",this.keyUpHandler)}exitExtrudeMode(){console.log("=== EXIT EXTRUDE MODE ==="),this.isExtrudeMode=!1,this.extrudeManager.cancelExtrudeMode(),this.detachEventListeners(),this.editor.showStatus("Режим вытягивания завершен","info")}onActivate(){console.log("ExtrudeTool: активирован"),this.editor.clearSelection(!1),this.startExtrudeMode()}onDeactivate(){console.log("ExtrudeTool: деактивирован"),this.exitExtrudeMode()}onMouseDown(e){if(console.log("ExtrudeTool: onMouseDown, кнопка:",e.button),0!==e.button)return!1;if(this.isExtrudeMode){if(console.log("Проверяем перетаскивание стрелки..."),this.extrudeManager.handleArrowDragStart(e))return console.log("Начато перетаскивание стрелки"),!0;console.log("Обрабатываем клик по фигуре...");if(this.extrudeManager.handleFigureClick(e))return console.log("Клик по фигуре обработан"),e.preventDefault(),e.stopPropagation(),!0}return!1}onMouseMove(e){this.isExtrudeMode&&(this.extrudeManager.isDraggingArrow?this.extrudeManager.handleArrowDrag(e):this.extrudeManager.highlightFiguresOnHover(e))}onMouseUp(e){return console.log("ExtrudeTool: onMouseUp, кнопка:",e.button),this.isExtrudeMode&&0===e.button&&this.extrudeManager.isDraggingArrow&&(console.log("Завершаем перетаскивание стрелки"),this.extrudeManager.handleArrowDragEnd()),!1}onKeyDown(e){return"Escape"===e.key&&this.isExtrudeMode?(console.log("Нажата Escape, выходим из режима вытягивания"),this.exitExtrudeMode(),this.editor.toolManager.setCurrentTool("select"),!0):!("Enter"!==e.key||!this.isExtrudeMode)&&(console.log("Нажата Enter, выполняем вытягивание"),this.extrudeManager.performExtrude(),!0)}onKeyUp(e){return!1}}