class RevolveTool extends Tool{constructor(e){super("revolve","fa-sync-alt",e),this.revolveManager=e.revolveManager,this.isRevolveMode=!1,console.log("RevolveTool: создан")}startRevolveMode(){console.log("=== START REVOLVE MODE ==="),this.isRevolveMode=!0,this.revolveManager.initialize(),this.revolveManager.highlightRevolvableFigures(),this.revolveManager.showRevolveUI(),this.attachEventListeners(),this.editor.showStatus("Режим вращения: кликните по фигурам для выбора","info")}attachEventListeners(){console.log("RevolveTool: добавляем обработчики событий"),this.mouseDownHandler=e=>this.onMouseDown(e),this.mouseMoveHandler=e=>this.onMouseMove(e),this.mouseUpHandler=e=>this.onMouseUp(e),this.keyDownHandler=e=>this.onKeyDown(e),this.keyUpHandler=e=>this.onKeyUp(e);const e=this.editor.renderer.domElement;e.addEventListener("mousedown",this.mouseDownHandler),e.addEventListener("mousemove",this.mouseMoveHandler),e.addEventListener("mouseup",this.mouseUpHandler),document.addEventListener("keydown",this.keyDownHandler),document.addEventListener("keyup",this.keyUpHandler)}detachEventListeners(){console.log("RevolveTool: удаляем обработчики событий");const e=this.editor.renderer.domElement;this.mouseDownHandler&&e.removeEventListener("mousedown",this.mouseDownHandler),this.mouseMoveHandler&&e.removeEventListener("mousemove",this.mouseMoveHandler),this.mouseUpHandler&&e.removeEventListener("mouseup",this.mouseUpHandler),this.keyDownHandler&&document.removeEventListener("keydown",this.keyDownHandler),this.keyUpHandler&&document.removeEventListener("keyup",this.keyUpHandler)}exitRevolveMode(){console.log("=== EXIT REVOLVE MODE ==="),this.isRevolveMode=!1,this.revolveManager.cancelRevolveMode(),this.detachEventListeners(),this.editor.showStatus("Режим вращения завершен","info")}onActivate(){console.log("RevolveTool: активирован"),this.startRevolveMode()}onDeactivate(){console.log("RevolveTool: деактивирован"),this.exitRevolveMode()}onMouseDown(e){if(console.log("RevolveTool: onMouseDown, кнопка:",e.button),0!==e.button)return!1;if(this.isRevolveMode){if(console.log("Проверяем перетаскивание оси..."),this.revolveManager.handleAxisDragStart(e))return console.log("Начато перетаскивание оси"),!0;console.log("Обрабатываем клик по фигуре...");if(this.revolveManager.handleFigureClick(e))return console.log("Клик по фигуре обработан"),e.preventDefault(),e.stopPropagation(),!0}return!1}onMouseMove(e){this.isRevolveMode&&(this.revolveManager.isDraggingAxis?this.revolveManager.handleAxisDrag(e):this.revolveManager.highlightFiguresOnHover(e))}onMouseUp(e){return console.log("RevolveTool: onMouseUp, кнопка:",e.button),this.isRevolveMode&&0===e.button&&this.revolveManager.isDraggingAxis&&(console.log("Завершаем перетаскивание оси"),this.revolveManager.handleAxisDragEnd()),!1}onKeyDown(e){if("Escape"===e.key&&this.isRevolveMode)return console.log("Нажата Escape, выходим из режима вращения"),this.exitRevolveMode(),this.editor.toolManager.setCurrentTool("select"),!0;if("Enter"===e.key&&this.isRevolveMode){console.log("Нажата Enter, выполняем вращение");const e=document.getElementById("performRevolve");if(e&&!e.disabled)return this.revolveManager.performRevolve(),!0}return!1}onKeyUp(e){return!1}}