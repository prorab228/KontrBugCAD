class RepairTool extends Tool{constructor(e){super("repair","fa-tools",e),this.requiresSelection=!0,this.fixOpenEdges=!0,this.removeIsolated=!0,this.createUVs=!1,this.removeSmallComponents=!0,this.minComponentSize=10}onActivate(){if(this.canActivate())return 0===this.editor.selectedObjects.length?(this.editor.showStatus("Нет выбранных объектов для ремонта","error"),void this.editor.toolManager.restorePreviousTool()):void this.showConfirmationDialog();this.editor.toolManager.restorePreviousTool()}showConfirmationDialog(){const e=document.createElement("div");e.className="modal-overlay active",e.style.cssText="\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0, 0, 0, 0.7);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            z-index: 10000;\n        ",e.innerHTML=`\n            <div class="modal-content" style="\n                background: white;\n                padding: 20px;\n                border-radius: 8px;\n                min-width: 350px;\n                max-width: 450px;\n                box-shadow: 0 5px 15px rgba(0,0,0,0.3);\n            ">\n                <h3 style="margin-top: 0; display: flex; align-items: center; gap: 8px;">\n                    <i class="fas fa-tools"></i> Ремонт геометрии\n                </h3>\n                <p style="margin-bottom: 15px; color: #555;">\n                    Будет выполнена проверка и исправление геометрии для\n                    <strong>${this.editor.selectedObjects.length}</strong> выбранных объектов.\n                </p>\n                <div style="margin: 15px 0; border-top: 1px solid #eee; padding-top: 15px;">\n                    <h4 style="margin: 0 0 10px 0; font-size: 14px;">Опции ремонта:</h4>\n                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">\n                        <input type="checkbox" id="fixOpenEdges" checked>\n                        <span><strong>Закрывать открытые грани</strong> (исправляет дыры)</span>\n                    </label>\n                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">\n                        <input type="checkbox" id="removeIsolated" checked>\n                        <span><strong>Удалять изолированные вершины</strong> (очистка)</span>\n                    </label>\n                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">\n                        <input type="checkbox" id="removeSmallComponents" checked>\n                        <span><strong>Удалять мелкие компоненты</strong> (менее 10 треугольников)</span>\n                    </label>\n                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">\n                        <input type="checkbox" id="createUVs">\n                        <span><strong>Создавать UV-координаты</strong> (для текстурирования)</span>\n                    </label>\n                </div>\n                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">\n                    <button id="cancelRepair" style="padding:8px 16px; background:#f0f0f0; border:none; border-radius:4px; cursor:pointer;">Отмена</button>\n                    <button id="applyRepair" style="padding:8px 16px; background:#2196F3; color:white; border:none; border-radius:4px; cursor:pointer;">Применить</button>\n                </div>\n            </div>\n        `,document.body.appendChild(e),document.getElementById("cancelRepair").addEventListener("click",()=>{document.body.removeChild(e),this.editor.toolManager.restorePreviousTool()}),document.getElementById("applyRepair").addEventListener("click",()=>{this.fixOpenEdges=document.getElementById("fixOpenEdges").checked,this.removeIsolated=document.getElementById("removeIsolated").checked,this.removeSmallComponents=document.getElementById("removeSmallComponents").checked,this.createUVs=document.getElementById("createUVs").checked,document.body.removeChild(e),this.performRepair()})}performRepair(){const e=this.editor.selectedObjects.map(e=>e.uuid),t={targets:e,fixOpenEdges:this.fixOpenEdges,removeIsolated:this.removeIsolated,removeSmallComponents:this.removeSmallComponents,createUVs:this.createUVs},n=new ParametricOperation("repair",t,e),o=this.editor.parametricModel.addOperation(n);this.editor.clearSelection(),o.forEach(e=>{const t=this.editor.parametricModel.objectMap.get(e);t&&(this.editor.selectedObjects.push(t),this.editor.objectsManager.highlightObject(t))}),this.editor.showStatus("Ремонт завершён","success"),this.editor.toolManager.setCurrentTool("select")}}