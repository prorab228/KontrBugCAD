import*as THREE from"three";import{ParametricOperation}from"/js/core/parametric/ParametricOperation.js";import{Tool}from"./tool.js";export class UngroupTool extends Tool{constructor(o){super("ungroup","fa-object-ungroup",o),this.requiresSelection=!0}onActivate(){if(!this.canActivate())return void this.editor.toolManager.restorePreviousTool();const o=this.editor.selectedObjects.filter(o=>"group"===o.userData?.type);if(0===o.length)return this.editor.showStatus("Для разгруппировки выберите группу","error"),void this.editor.toolManager.restorePreviousTool();this.performUngrouping(o),setTimeout(()=>{this.editor.toolManager.restorePreviousTool()},100)}performUngrouping(o){const t=[];o.forEach(o=>{const e=[];o.children.forEach(t=>{if(t!==o){const o=new THREE.Vector3;t.getWorldPosition(o),e.push({uuid:t.uuid,worldPosition:o.toArray()})}});const r=new ParametricOperation("ungroup",{groupId:o.uuid,childrenData:e},[]);this.editor.parametricModel.addOperation(r),t.push(...e.map(o=>o.uuid))}),setTimeout(()=>{const o=[];t.forEach(t=>{const e=this.editor.parametricModel.objectMap.get(t);e&&o.push(e)}),this.editor.clearSelection(),o.forEach(o=>{this.editor.selectedObjects.push(o),this.editor.objectsManager.highlightObject(o)})},0),this.editor.showStatus(`Разгруппировано ${o.length} групп`,"success")}onDeactivate(){}}