class SketchToolManager{constructor(e){this.sketchManager=e,this.tools={},this.currentTool=null,this.currentToolName=null}initTools(){this.registerTool("select",new SelectSketchTool(this.sketchManager)),this.registerTool("line",new LineSketchTool(this.sketchManager)),this.registerTool("rectangle",new RectangleSketchTool(this.sketchManager)),this.registerTool("circle",new CircleSketchTool(this.sketchManager)),this.registerTool("polyline",new PolylineSketchTool(this.sketchManager)),this.registerTool("polygon",new PolygonSketchTool(this.sketchManager)),this.registerTool("arc",new ArcSketchTool(this.sketchManager)),this.registerTool("oval",new OvalSketchTool(this.sketchManager)),this.registerTool("stadium",new StadiumSketchTool(this.sketchManager)),this.registerTool("mirror",new MirrorSketchTool(this.sketchManager)),this.registerTool("dimension",new DimensionSketchTool(this.sketchManager)),this.registerTool("ruler",new RulerSketchTool(this.sketchManager)),this.registerTool("dashedline",new DashedLineSketchTool(this.sketchManager)),this.setCurrentTool("line")}registerTool(e,t){this.tools[e]=t,t.name=e}setCurrentTool(e){console.log(`Setting current sketch tool to: ${e}`),this.currentTool&&this.deactivateCurrentTool(),this.currentToolName=e,this.currentTool=this.tools[e],this.sketchManager.cursorCrossVisible="select"!==e&&"ruler"!==e&&"dimension"!==e,this.updateCursorCross(),this.sketchManager.updateToolButtons()}deactivateCurrentTool(){this.currentTool&&(this.currentTool.onCancel(),"function"==typeof this.currentTool.onDeactivate&&this.currentTool.onDeactivate(),this.currentTool=null,this.currentToolName=null)}updateCursorCross(){this.sketchManager.currentPlane&&(this.sketchManager.cursorCross&&(this.sketchManager.currentPlane.remove(this.sketchManager.cursorCross),this.sketchManager.cursorCross=null),this.sketchManager.cursorCrossVisible&&this.createCursorCross())}createCursorCross(){if(!this.sketchManager.currentPlane)return;const e=(new THREE.BufferGeometry).setFromPoints([new THREE.Vector3(-1,0,.2),new THREE.Vector3(1,0,.2)]),t=(new THREE.BufferGeometry).setFromPoints([new THREE.Vector3(0,-1,.2),new THREE.Vector3(0,1,.2)]),s=new THREE.LineBasicMaterial({color:2237183,linewidth:4,transparent:!0,opacity:.7}),r=new THREE.Line(e,s),o=new THREE.Line(t,s);this.sketchManager.cursorCross=new THREE.Group,this.sketchManager.cursorCross.add(r,o),this.sketchManager.cursorCross.userData.isCursorCross=!0,this.sketchManager.currentPlane.add(this.sketchManager.cursorCross)}onMouseDown(e){return this.sketchManager.dimensionManager.isInputActive?(this.sketchManager.dimensionManager.contains(e.target)||this.sketchManager.dimensionManager.applyDimensionInput(),!1):!!this.currentTool&&this.currentTool.onMouseDown(e)}onMouseMove(e){const t=this.sketchManager.getPointOnPlane(e);if(t){let s=t;this.sketchManager.snapHelper&&this.sketchManager.snapHelper.snapEnabled&&(s=this.sketchManager.snapHelper.getSnappedPoint(t)),this.updateCursorPosition(s),this.sketchManager.updateCoordinates(s),this.sketchManager.snapHelper&&this.sketchManager.snapHelper.handleMouseMove(e,t)}this.currentTool&&this.currentTool.onMouseMove(e)}onMouseUp(e){this.sketchManager.isInputActive||this.currentTool&&this.currentTool.onMouseUp(e)}onKeyDown(e){switch(e.key){case"Enter":if(this.sketchManager.isInputActive)return this.sketchManager.applyDimensionInput(),e.preventDefault(),!0;break;case"Escape":if(this.sketchManager.isInputActive)return this.sketchManager.dimensionManager.hideDimensionInput(),e.preventDefault(),!0;if(this.currentTool)return this.currentTool.onCancel(),e.preventDefault(),!0}return!(!this.currentTool||!this.currentTool.onKeyDown)&&this.currentTool.onKeyDown(e)}updateCursorPosition(e){if(!this.sketchManager.currentPlane||!this.sketchManager.cursorCross)return;const t=this.sketchManager.currentPlane.worldToLocal(e.clone());this.sketchManager.cursorCross.position.set(t.x,t.y,0)}clear(){this.deactivateCurrentTool(),this.tools={},this.currentTool=null,this.currentToolName=null}}