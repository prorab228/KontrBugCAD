class SketchDimensionManager{constructor(n){this.sketchManager=n,this.dimensionInput=null,this.inputField1=null,this.inputField2=null,this.inputField3=null,this.isInputActive=!1}createDimensionInput(){const n=document.getElementById("sketchDimensionInput");n&&n.remove(),this.dimensionInput=document.createElement("div"),this.dimensionInput.id="sketchDimensionInput",this.dimensionInput.className="dimension-input-overlay",this.dimensionInput.style.cssText="\n            position: fixed;\n            background: rgba(0, 0, 0, 0.8);\n            color: white;\n            padding: 8px 12px;\n            border-radius: 4px;\n            font-family: 'Segoe UI', Arial, sans-serif;\n            font-size: 12px;\n            z-index: 10000;\n            pointer-events: none;\n            opacity: 0;\n            transition: opacity 0.2s;\n            border: 1px solid #00c853;\n            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);\n        ",this.dimensionInput.innerHTML='\n            <div style="display: flex; flex-direction: column; gap: 6px; min-width: 150px;">\n                <div class="input-row" id="inputRow1" style="display: none; align-items: center; gap: 8px;">\n                    <label style="min-width: 40px; color: #aaa;">Длина:</label>\n                    <input type="number" id="dimensionInput1" style="width: 80px; padding: 4px 6px; background: #333; color: white; border: 1px solid #666; border-radius: 3px; outline: none;">\n                    <span style="color: #aaa;">мм</span>\n                </div>\n                <div class="input-row" id="inputRow2" style="display: none; align-items: center; gap: 8px;">\n                    <label style="min-width: 40px; color: #aaa;">Высота:</label>\n                    <input type="number" id="dimensionInput2" style="width: 80px; padding: 4px 6px; background: #333; color: white; border: 1px solid #666; border-radius: 3px; outline: none;">\n                    <span style="color: #aaa;">мм</span>\n                </div>\n                <div class="input-row" id="inputRow3" style="display: none; align-items: center; gap: 8px;">\n                    <label style="min-width: 40px; color: #aaa;">Стороны:</label>\n                    <input type="number" id="dimensionInput3" style="width: 80px; padding: 4px 6px; background: #333; color: white; border: 1px solid #666; border-radius: 3px; outline: none;">\n                    <span style="color: #aaa;">шт</span>\n                </div>\n                <div class="input-hint" style="font-size: 10px; color: #888; margin-top: 4px;">\n                    Enter - применить, Esc - отмена\n                </div>\n            </div>\n        ',document.body.appendChild(this.dimensionInput),this.inputField1=document.getElementById("dimensionInput1"),this.inputField2=document.getElementById("dimensionInput2"),this.inputField3=document.getElementById("dimensionInput3"),this.setupInputListeners()}setupInputListeners(){[this.inputField1,this.inputField2,this.inputField3].forEach((n,e)=>{n&&(n.addEventListener("keydown",n=>this.handleInputKeyDown(n,e+1)),n.addEventListener("input",n=>this.handleInputChange(n,e+1)))}),document.addEventListener("mousedown",n=>{this.dimensionInput&&"1"===this.dimensionInput.style.opacity&&!this.dimensionInput.contains(n.target)&&this.applyDimensionInput()})}showDimensionInput(n,e){if(!this.dimensionInput||!e)return;this.sketchManager.editor.renderer.domElement.getBoundingClientRect();this.dimensionInput.style.left=`${n.clientX+15}px`,this.dimensionInput.style.top=n.clientY-10+"px",this.dimensionInput.style.opacity="1",this.dimensionInput.style.pointerEvents="auto";for(let n=1;n<=3;n++){const e=document.getElementById(`inputRow${n}`);e&&(e.style.display="none")}e.fields&&Array.isArray(e.fields)&&e.fields.forEach((n,e)=>{const t=document.getElementById(`inputRow${e+1}`);if(t){t.style.display="flex";const e=t.querySelector("label"),i=t.querySelector("input"),s=t.querySelector("span");e&&(e.textContent=n.label+":"),i&&(i.type=n.type||"number",i.value=n.value||"",i.min=n.min||"",i.max=n.max||"",i.step=n.step||"1",i.placeholder=n.placeholder||""),s&&(s.textContent=n.unit||"")}}),this.inputField1&&(this.inputField1.focus(),this.inputField1.select()),this.isInputActive=!0}applyDimensionInput(){if(!this.sketchManager.toolManager.currentTool)return console.error("Нет активного инструмента"),void this.hideDimensionInput();const n=this.sketchManager.toolManager.currentTool,e={};for(let n=1;n<=3;n++){const t=document.getElementById(`inputRow${n}`);if(t&&"none"!==t.style.display){const i=t.querySelector("input");if(i){const t=`value${n}`;"number"===i.type?e[t]=parseFloat(i.value)||0:e[t]=i.value.trim()}}}n.applyDimensions?n.applyDimensions(e):n.applyDimensionInput&&n.applyDimensionInput(),this.hideDimensionInput(),n.clearTempGeometry&&n.clearTempGeometry(),n.tempElement&&(n.tempElement=null)}hideDimensionInput(){this.dimensionInput&&(this.dimensionInput.style.opacity="0",this.dimensionInput.style.pointerEvents="none",this.isInputActive=!1)}handleInputKeyDown(n,e){switch(n.stopPropagation(),n.key){case"Tab":n.preventDefault(),this.focusNextInput(e);break;case"Enter":this.applyDimensionInput(),n.preventDefault();break;case"Escape":this.hideDimensionInput(),this.sketchManager.toolManager.currentTool&&this.sketchManager.toolManager.currentTool.onCancel(),n.preventDefault()}}handleInputChange(n,e){if(!this.sketchManager.toolManager.currentTool||!this.sketchManager.toolManager.currentTool.tempElement)return;const t=parseFloat(n.target.value)||0;this.sketchManager.toolManager.currentTool.handleInputChange&&this.sketchManager.toolManager.currentTool.handleInputChange(e,t)}focusNextInput(n){const e=[this.inputField1,this.inputField2,this.inputField3],t=n%e.length;e[t]&&"none"!==e[t].style.display&&(e[t].focus(),e[t].select())}clearDimensionObjects(){this.sketchManager.dimensionObjects&&(this.sketchManager.dimensionObjects.forEach(n=>{n.parent&&n.parent.remove(n),n.geometry&&n.geometry.dispose(),n.material&&n.material.dispose(),n.map&&n.map.dispose()}),this.sketchManager.dimensionObjects=[])}clear(){this.hideDimensionInput(),this.clearDimensionObjects(),this.dimensionInput&&(this.dimensionInput.remove(),this.dimensionInput=null),this.inputField1=null,this.inputField2=null,this.inputField3=null,this.isInputActive=!1}}