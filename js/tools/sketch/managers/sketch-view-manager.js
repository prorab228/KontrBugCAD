class SketchViewManager{constructor(e){this.sketchManager=e,this.grid=null,this.gridVisible=!0,this.sketchManager.gridStep=1,this.sketchManager.gridUnit="mm",this.originalCameraUp=new THREE.Vector3(0,1,0),this.originalCameraPosition=new THREE.Vector3,this.originalCameraTarget=new THREE.Vector3}createSketchGrid(){if(this.removeSketchGrid(),!this.sketchManager.currentPlane||!this.gridVisible)return;let e=this.sketchManager.gridStep;"inch"===this.sketchManager.editor.gridUnit&&(e*=25.4);const t=50,r=e,i=t/r,a=2236962,s=5592405;for(let e=1;e<=i;e++){const i=e*r;this.createGridLine(-50,i,t,i,0===e?s:a)}for(let e=0;e>=-i;e--){const i=e*r;this.createGridLine(-50,i,t,i,0===e?s:a)}for(let e=1;e<=i;e++){const i=e*r;this.createGridLine(i,-50,i,t,0===e?s:a)}for(let e=0;e>=-i;e--){const i=e*r;this.createGridLine(i,-50,i,t,0===e?s:a)}}createGridLine(e,t,r,i,a){const s=new THREE.Vector3(e,t,.05),o=new THREE.Vector3(r,i,.05),n=(new THREE.BufferGeometry).setFromPoints([s,o]),c=new THREE.LineBasicMaterial({color:a,linewidth:1,transparent:!0,opacity:.1}),h=new THREE.Line(n,c);h.userData.isGrid=!0,this.sketchManager.currentPlane.add(h),this.grid||(this.grid=[]),this.grid.push(h)}removeSketchGrid(){this.grid&&(this.grid.forEach(e=>{e.parent&&e.parent.remove(e),e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}),this.grid=null)}updateGrid(){this.gridVisible?this.createSketchGrid():this.removeSketchGrid()}setGridVisible(e){this.gridVisible=e,this.gridVisible?this.createSketchGrid():this.removeSketchGrid()}orientCameraToPlane(e,t=!0){t&&(this.originalCameraUp.copy(this.sketchManager.editor.camera.up),this.originalCameraPosition.copy(this.sketchManager.editor.camera.position),this.originalCameraTarget.copy(this.sketchManager.editor.controls.target));const r=new THREE.Vector3(0,1,0).applyQuaternion(e.quaternion),i=new THREE.Vector3(0,0,1).applyQuaternion(e.quaternion),a=(new THREE.Box3).setFromObject(e),s=new THREE.Vector3;a.getSize(s);const o=Math.max(s.x,s.y,s.z),n=Math.max(o,100)/2,c=new THREE.Vector3;a.getCenter(c);const h=c.clone().add(i.clone().multiplyScalar(n));this.sketchManager.editor.camera.position.copy(h),this.sketchManager.editor.camera.lookAt(c),this.sketchManager.editor.camera.up.copy(r),this.sketchManager.editor.camera.up.normalize(),this.sketchManager.editor.controls.target.copy(c),this.sketchManager.editor.controls.update()}setViewCameraToCurrentPlane(){this.sketchManager.currentPlane&&this.orientCameraToPlane(this.sketchManager.currentPlane,!1)}restoreCamera(){this.sketchManager.editor.camera.up.copy(this.originalCameraUp),this.sketchManager.editor.camera.up.normalize(),this.sketchManager.editor.camera.position.copy(this.originalCameraPosition),this.sketchManager.editor.controls.target.copy(this.originalCameraTarget),this.sketchManager.editor.camera.lookAt(this.sketchManager.editor.controls.target),this.sketchManager.editor.controls.update()}clear(){this.removeSketchGrid(),this.grid=null,this.gridVisible=!0}}