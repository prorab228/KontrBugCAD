import*as THREE from"three";import{SketchToolBase}from"./sketch-tool-base.js";export class TransformSketchToolBase extends SketchToolBase{constructor(t,e,n){super(t,e,n),this.inputContainer=null,this.inputElement=null,this.isInputFocused=!1,this.lastInputValue=0,this.initTransformInput()}initTransformInput(){this.inputContainer=document.createElement("div"),this.inputContainer.className="distance-input-container",this.inputElement=document.createElement("input"),this.inputElement.type="number",this.inputElement.step="0.1",this.inputContainer.appendChild(this.inputElement),document.body.appendChild(this.inputContainer),this.inputElement.addEventListener("focus",()=>{this.isInputFocused=!0,this.inputContainer.style.borderColor="#2196F3"}),this.inputElement.addEventListener("blur",()=>{this.isInputFocused=!1,this.inputContainer.style.borderColor="#4CAF50"}),this.inputElement.addEventListener("keydown",t=>{"Enter"===t.key?(this.applyInputValue(),this.inputElement.blur()):"Escape"===t.key&&(this.cancelInput(),this.inputElement.blur())})}showInput(t="",e=null,n=!0){this.inputContainer&&this.sketchManager.currentPlane&&(this.inputElement.value=t,this.inputContainer.style.display="block",e&&this.updateInputPosition(e),n&&setTimeout(()=>{this.inputElement.focus(),this.inputElement.select()},10))}hideInput(){this.inputContainer&&(this.inputContainer.style.display="none"),this.isInputFocused=!1}updateInputPosition(t){if(!this.inputContainer||!t||!this.sketchManager.currentPlane)return;const e=this.sketchManager.currentPlane.localToWorld(t.clone()),n=this.worldToScreen(e,this.sketchManager.editor.camera,this.sketchManager.editor.renderer),i=window.innerWidth,s=window.innerHeight;let u=n.x-50,o=n.y-40-10;u<10&&(u=10),u+100>i-10&&(u=i-100-10),o<10&&(o=n.y+20),o+40>s-10&&(o=s-40-10),this.inputContainer.style.left=`${u}px`,this.inputContainer.style.top=`${o}px`}worldToScreen(t,e,n){const i=t.clone();i.project(e);return{x:(.5*i.x+.5)*n.domElement.clientWidth,y:(-.5*i.y+.5)*n.domElement.clientHeight}}applyInputValue(){console.warn("applyInputValue должен быть переопределен в дочернем классе")}cancelInput(){this.hideInput()}updateInputValue(t,e=null){this.inputContainer&&this.sketchManager.currentPlane&&(this.inputElement.value=t,this.inputContainer.style.display="block",e&&this.updateInputPosition(e))}clearTransformInput(){this.hideInput(),this.lastInputValue=0}onDeactivate(){super.onDeactivate(),this.clearTransformInput()}}