class DashedLineSketchTool extends LineBaseTool{constructor(e){super(e,"dashedline","fa-grip-lines"),this.dashSize=.5,this.gapSize=.5,this.dimensionFields=[{label:"Длина",type:"number",value:10,unit:"мм",min:1,step:1},{label:"Угол",type:"number",value:0,unit:"°",min:0,max:360,step:1},{label:"Длина штриха",type:"number",value:this.dashSize,unit:"мм",min:.5,step:.5}]}updateInputFields(){if(!this.sketchManager.dimensionManager.isInputActive||!this.tempElement)return;const e=[this.sketchManager.dimensionManager.inputField1,this.sketchManager.dimensionManager.inputField2,this.sketchManager.dimensionManager.inputField3];e[0]&&(e[0].value=this.tempElement.length.toFixed(1)),e[1]&&(e[1].value=this.tempElement.angle.toFixed(1)),e[2]&&(e[2].value=(this.tempElement.dashSize||this.dashSize).toFixed(1))}applyDimensions(e){this.tempElement&&(e.value1&&e.value1>0&&this.updateLineLength(e.value1),void 0!==e.value2&&this.updateLineAngle(e.value2),e.value3&&e.value3>0&&(this.tempElement.dashSize=e.value3,this.tempElement.gapSize=e.value3,this.dashSize=e.value3),this.sketchManager.elementManager.addElement(this.tempElement),this.clearTempGeometry(),this.sketchManager.dimensionManager.clearDimensionObjects(),this.hideAngleIndicator(),this.tempElement=null)}createGeometry(e){const t=[];e.points.forEach(e=>{const i=this.sketchManager.currentPlane.worldToLocal(e.clone());t.push(i.x,i.y,0)});const i=new THREE.BufferGeometry;i.setAttribute("position",new THREE.Float32BufferAttribute(t,3));const a=new THREE.LineDashedMaterial({color:e.color||this.sketchManager.sketchColor,linewidth:2,dashSize:e.dashSize||this.dashSize,gapSize:this.gapSize,scale:1}),s=new THREE.Line(i,a);return s.computeLineDistances(),s}updateGeometry(e,t){const i=[];t.points.forEach(e=>{const t=this.sketchManager.currentPlane.worldToLocal(e.clone());i.push(t.x,t.y,0)}),e.geometry.setAttribute("position",new THREE.Float32BufferAttribute(i,3)),e.geometry.attributes.position.needsUpdate=!0,e.material instanceof THREE.LineDashedMaterial&&(e.material.dashSize=t.dashSize||this.dashSize,e.material.gapSize=this.gapSize,e.material.needsUpdate=!0),e.computeLineDistances()}createTempGeometry(){if(this.clearTempGeometry(),!this.tempElement)return;const e={...this.tempElement};e.color=this.sketchManager.previewColor;const t=this.createGeometry(e);t&&(this.tempGeometry=t,this.sketchManager.currentPlane.add(this.tempGeometry))}updateTempGeometry(){if(!this.tempGeometry||!this.tempElement)return;const e=[];this.tempElement.points.forEach(t=>{const i=this.sketchManager.currentPlane.worldToLocal(t.clone());e.push(i.x,i.y,0)}),this.tempGeometry.geometry.setAttribute("position",new THREE.Float32BufferAttribute(e,3)),this.tempGeometry.geometry.attributes.position.needsUpdate=!0,this.tempGeometry.material instanceof THREE.LineDashedMaterial&&(this.tempGeometry.material.dashSize=this.tempElement.dashSize||this.dashSize,this.tempGeometry.material.gapSize=this.gapSize,this.tempGeometry.material.needsUpdate=!0),this.tempGeometry.computeLineDistances()}}