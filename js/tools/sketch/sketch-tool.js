class SketchTool extends Tool{constructor(e){super("sketch","fa-drafting-compass",e),this.sketchMode=null,this.currentSketchPlane=null,this.sketchManager=e.sketchManager}openSketch(){if("drawing"!==this.sketchMode){if(1===this.editor.selectedObjects.length){const e=this.editor.selectedObjects[0];if("sketch_plane"===e.userData.type||"work_plane"===e.userData.type){return void(this.editor.objectsManager.checkPlaneForSketchElements(e)?this.editExistingSketch(e):this.startSketchOnPlane(e))}}this.editor.showStatus("Выберите плоскость для скетча (рабочую или скетч-плоскость)","error")}else this.exitSketchMode()}editExistingSketch(e){this.sketchManager&&(this.sketchMode="drawing",this.sketchManager.editExistingSketch(e),document.getElementById("sketchToolsSection").style.display="flex",this.editor.toolManager.setCurrentTool("select"),this.editor.showStatus("Режим редактирования скетча. Используйте инструменты рисования.","info"))}startSketchOnPlane(e){const t=this.editor.planesManager.createSketchPlaneObject();t.position.copy(e.position),t.quaternion.copy(e.quaternion),this.editor.objectsGroup.add(t),this.editor.objects.push(t),this.editor.sketchPlanes.push(t),this.currentSketchPlane=t,this.sketchMode="drawing",document.getElementById("sketchToolsSection").style.display="flex",this.sketchManager&&(this.sketchManager.startSketchOnPlane(t),this.sketchManager.setCurrentTool("line")),this.setSketchTool("line"),this.editor.showStatus("Режим скетча: используйте инструменты рисования","info")}exitSketchMode(){null!==this.sketchMode&&(this.sketchMode=null,this.currentSketchPlane=null,document.getElementById("sketchToolsSection").style.display="none",this.sketchManager&&this.sketchManager.exitSketchMode(),this.editor.toolManager.setCurrentTool("select"),this.editor.showStatus("Режим скетча завершен","info"))}setSketchTool(e){if(this.sketchManager&&"drawing"===this.sketchMode){this.sketchManager.setCurrentTool(e),document.querySelectorAll(".sketch-tool-btn").forEach(t=>{t.classList.remove("active"),t.dataset.sketchTool===e&&t.classList.add("active")});const t={select:"Выделение",line:"Линия",rectangle:"Прямоугольник",circle:"Окружность",polyline:"Полилиния"};if(this.sketchManager.sizeDisplay){const s=this.sketchManager.sizeDisplay.querySelector("#sizeInfo");s&&(s.textContent=`Инструмент: ${t[e]||e}`)}}}onActivate(){this.openSketch()}onDeactivate(){this.exitSketchMode()}onMouseDown(e){return!("drawing"!==this.sketchMode||!this.sketchManager)&&this.sketchManager.onMouseDown(e)}onMouseMove(e){"drawing"===this.sketchMode&&this.sketchManager&&this.sketchManager.onMouseMove(e)}onMouseUp(e){"drawing"===this.sketchMode&&this.sketchManager&&this.sketchManager.onMouseUp(e)}onKeyDown(e){return"Escape"===e.key&&"drawing"===this.sketchMode&&(this.editor.toolManager.setCurrentTool("select"),!0)}onDoubleClick(e){if(0!==e.button)return!1;this.editor.updateMousePosition(e),this.editor.raycaster.setFromCamera(this.editor.mouse,this.editor.camera);const t=this.editor.raycaster.intersectObjects(this.editor.objectsGroup.children,!0);if(t.length>0){const e=this.editor.objectsManager.findTopParent(t[0].object);if("sketch_plane"===e.userData.type||"work_plane"===e.userData.type){if(this.editor.objectsManager.checkPlaneForSketchElements(e))return this.editor.selectSingleObject(e),this.editExistingSketch(e),!0}}return!1}}