class SketchTool extends Tool{constructor(e){super("sketch","fa-drafting-compass",e),this.sketchMode=null,this.currentSketchPlane=null,this.sketchManager=e.sketchManager}openSketch(){if("drawing"!==this.sketchMode){if(1===this.editor.selectedObjects.length){const e=this.editor.selectedObjects[0];if("sketch_plane"===e.userData.type)return void this.editExistingSketch(e);if("work_plane"===e.userData.type)return void this.startSketchOnPlane(e)}this.editor.showStatus("Выберите плоскость для скетча (рабочую или скетч-плоскость)","error")}else this.exitSketchMode()}editExistingSketch(e){this.sketchManager&&(this.sketchMode="drawing",this.sketchManager.editExistingSketch(e),document.getElementById("sketchToolsSection").style.display="flex",this.editor.clearSelection(),this.editor.showStatus("Режим редактирования скетча. Используйте инструменты рисования.","info"))}startSketchOnPlane(e){const t=this.editor.planesManager.createSketchPlaneObject();t.position.copy(e.position),t.quaternion.copy(e.quaternion),this.editor.objectsGroup.add(t),this.editor.objects.push(t),this.editor.sketchPlanes.push(t),this.currentSketchPlane=t,this.sketchMode="drawing",document.getElementById("sketchToolsSection").style.display="flex",this.sketchManager&&(this.sketchManager.startSketchOnPlane(t),this.sketchManager.setCurrentTool("select")),e.visible=!1,this.editor.showStatus("Режим скетча: используйте инструменты рисования","info")}exitSketchMode(){null!==this.sketchMode&&(this.sketchMode=null,this.currentSketchPlane=null,document.getElementById("sketchToolsSection").style.display="none",this.sketchManager&&this.sketchManager.exitSketchMode(),this.editor.toolManager.setCurrentTool("select"),this.editor.showStatus("Режим скетча завершен","info"))}createPropertiesSection(){const e=document.getElementById("propertiesContent");e&&(console.log("Создание раздела свойств для sketch"),this.removePropertiesSection(),this.propertiesElement=document.createElement("div"),this.propertiesElement.className="property-group",this.propertiesElement.setAttribute("data-tool","sketch"),this.propertiesElement.innerHTML=this.getPropertiesHTML(),e.appendChild(this.propertiesElement),this.bindPropertiesEvents())}removePropertiesSection(){const e=propertiesContent.querySelector('.property-group[data-tool="sketch"]');e&&e.remove()}getPropertiesHTML(){return`\n            <div class="property-group" data-type="move-position">\n                <h4> СКЕТЧ</h4>\n\n                <div class="property-row">\n                    <label>Обнаружение замкнутых контуров (может нагружать компьютер):</label>\n                    <input type="checkbox" id="autoDetectContours" ${this.sketchManager.autoDetectContours?"checked":""}>\n                </div>\n            </div>\n        `}bindPropertiesEvents(){if(!this.propertiesElement)return;const e=this.propertiesElement.querySelector("#autoDetectContours");e&&(e.checked=this.sketchManager.autoDetectContours,e.addEventListener("change",e=>{this.sketchManager.autoDetectContours=e.target.checked}))}onActivate(){this.openSketch(),this.createPropertiesSection()}onDeactivate(){this.exitSketchMode(),this.removePropertiesSection()}onMouseDown(e){return!("drawing"!==this.sketchMode||!this.sketchManager)&&this.sketchManager.onMouseDown(e)}onMouseMove(e){"drawing"===this.sketchMode&&this.sketchManager&&this.sketchManager.onMouseMove(e)}onMouseUp(e){"drawing"===this.sketchMode&&this.sketchManager&&this.sketchManager.onMouseUp(e)}onKeyDown(e){return console.log("sketch-tool onKeyDown",e),this.sketchManager.onKeyDown(e)}}