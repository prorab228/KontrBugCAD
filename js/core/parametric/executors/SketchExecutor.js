import*as THREE from"three";import{ParametricExecutor}from"./ParametricExecutor.js";export class SketchExecutor extends ParametricExecutor{execute(e,t){const{planeId:r,elements:a}=e.parameters,o=t.objectMap.get(r);if(!o)throw new Error(`Sketch: плоскость ${r} не найдена`);const s=[];o.children.forEach(e=>{e.userData&&"sketch_element"===e.userData.type&&s.push(e)}),s.forEach(e=>{o.remove(e),e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()});const n=[];for(const e of a){const t=this.createSketchElement(e,o);t&&(o.add(t),n.push(t))}return o.userData.hasSketch=n.length>0,o.userData.sketchElementsCount=n.length,o.userData.sketchElements=a,null}createSketchElement(e,t){const{type:r,points:a,color:o,closed:s,dashed:n,dashSize:c,gapSize:i}=e,l=[];a.forEach(e=>l.push(e[0],e[1],.01));const h=new THREE.BufferGeometry;let E,u;return h.setAttribute("position",new THREE.Float32BufferAttribute(l,3)),E=n?new THREE.LineDashedMaterial({color:o,dashSize:c,gapSize:i,linewidth:2}):new THREE.LineBasicMaterial({color:o,linewidth:2}),u=s?new THREE.LineLoop(h,E):new THREE.Line(h,E),u.userData={type:"sketch_element",elementType:r,points:a.map(e=>new THREE.Vector3(e[0],e[1],0)),closed:s,dashed:n,originalColor:o,sketchPlaneId:t.uuid},n&&u.computeLineDistances(),u}}