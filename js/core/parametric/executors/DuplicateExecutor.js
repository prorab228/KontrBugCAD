import*as THREE from"three";import{ParametricExecutor}from"./ParametricExecutor.js";export class DuplicateExecutor extends ParametricExecutor{_deepCloneResources(e){e.geometry&&(e.geometry=e.geometry.clone()),e.material&&(Array.isArray(e.material)?e.material=e.material.map(e=>e.clone()):e.material=e.material.clone()),e.children.forEach(e=>this._deepCloneResources(e))}execute(e,t){const{sourceUuids:r,offset:o=[10,0,0]}=e.parameters,a=[];for(const e of r){const r=t.objectMap.get(e);if(!r)throw new Error(`DuplicateExecutor: исходный объект с UUID ${e} не найден в модели`);const i=r.clone();this._deepCloneResources(i),i.position.copy(r.position),i.position.x+=o[0],i.position.y+=o[1],i.position.z+=o[2],i.userData=JSON.parse(JSON.stringify(r.userData||{})),i.userData.originalUuid=r.uuid,i.userData.originalMaterial=r.userData.originalMaterial,a.push(i)}if(e.outputs&&e.outputs.length===a.length)for(let t=0;t<a.length;t++)a[t].uuid=e.outputs[t];else e.outputs=a.map(e=>e.uuid);return a}}