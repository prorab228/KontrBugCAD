class SplitExecutor extends ParametricExecutor{constructor(e){super(),this.editor=e}execute(e,t){const{target:a,planeId:r}=e.parameters,o=t.objectMap.get(a);if(!o)throw new Error(`Split: объект ${a} не найден`);const i=t.objectMap.get(r);if(!i)throw new Error(`Split: плоскость ${r} не найдена`);const s=this.cutWithCSG(o,i);return t.objectMap.delete(a),t.sceneGroup.remove(o),s}cutWithCSG(e,t){if(!this.editor.booleanOps)throw new Error("Библиотека булевых операций не загружена");const a=new THREE.Vector3(0,0,1).applyQuaternion(t.quaternion).normalize(),r=t.position.clone(),o=(new THREE.Box3).setFromObject(e),i=new THREE.Vector3;o.getSize(i);const s=Math.max(i.x,i.y,i.z),n=this.createHalfSpace(a,r,!0,s),c=this.createHalfSpace(a,r,!1,s),l=this.editor.booleanOps.intersect(e,n),p=this.editor.booleanOps.intersect(e,c);return n.geometry.dispose(),c.geometry.dispose(),this.setupPart(l,e,"positive"),this.setupPart(p,e,"negative"),[l,p]}createHalfSpace(e,t,a,r){const o=10*r,i=new THREE.BoxGeometry(o,o,o),s=new THREE.Mesh(i,new THREE.MeshBasicMaterial),n=e.clone().multiplyScalar(a?o/2:-o/2);return s.position.copy(t.clone().add(n)),s.lookAt(t.clone().add(e)),s}setupPart(e,t,a){e.userData=JSON.parse(JSON.stringify(t.userData||{})),e.userData.name=`${t.userData?.name||"Объект"} (${a})`,e.userData.isSplitPart=!0,e.userData.originalObject=t.uuid,e.userData.splitSide=a;const r=t.userData?.originalMaterial||t.material;r&&(Array.isArray(r)?e.material=r.map(e=>e.clone()):e.material=r.clone(),e.userData.originalMaterial=e.material),e.updateMatrixWorld(!0)}}